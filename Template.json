{
  "Name": "Brewmaster.ElasticSearch",
  "Description": "Elastic Search Farm",
  "Parameters": [
    {
      "Name": "Region",
      "Type": "String",
      "TypeHint": "AzureRegionName",
      "Description": "Name of Azure region."
    },
    {
      "Name": "AffinityGroup",
      "Type": "String",
      "TypeHint": "AzureAffinityGroupName",
      "Description": "Name of Azure affinity group."
    },
    {
      "Name": "CloudService",
      "Type": "String",
      "TypeHint": "AzureCloudServiceName",
      "Description": "Name of the Azure Cloud Service."
    },
    {
      "Name": "DiskStore",
      "Type": "String",
      "TypeHint": "AzureStorageName",
      "Description": "Name of Azure disk storage account."
    },
    {
      "Name": "CloudDeploymentName",
      "Type": "String",
      "TypeHint": "Guid",
      "Description": "Name of Azure cloud deployment."
    },
    {
      "Name": "VMSize",
      "Type": "String",
      "TypeHint": "AzureRoleSize",
      "Description": "Size of the server VMs.",
      "Default": "Small"
    },
    {
      "Name": "AdminName",
      "Type": "String",
      "TypeHint": "username",
      "Description": "Name of local administrator account.",
      "Minimum": 1.0,
      "Maximum": 64.0
    },
    {
      "Name": "AdminPassword",
      "Type": "String",
      "TypeHint": "password",
      "Description": "Password of local administrator account.",
      "MaskValue": true,
      "Minimum": 8.0,
      "Maximum": 127.0
    },
    {
      "Name": "ServerNamePrefix",
      "Type": "String",
      "Description": "Name prefix for web servers.",
      "Default": "arr",
      "AllowedRegex": "^[a-zA-Z][a-zA-Z0-9-]{1,13}$",
      "AllowedDescription": "Must contain 3 to 14 letters, numbers, and hyphens. Must start with a letter."
    },
    {
      "Name": "NumberOfWebServers",
      "Type": "Number",
      "TypeHint": "integer",
      "Description": "Number of web servers.",
      "Default": "2",
      "AllowedRegex": "^\\d+$",
      "AllowedDescription": "Must enter a positive integer between 2 and 100.",
      "Minimum": 2.0,
      "Maximum": 100.0
    }
  ],
  "Network": {
    "DnsServers": [],
    "LocalSites": [],
    "VirtualSites": []
  },
  "AffinityGroup": {
    "Name": "{{AffinityGroup}}",
    "Region": "{{Region}}"
  },
  "StorageAccounts": [
    {
      "Name": "{{DiskStore}}",
      "AffinityGroup": "{{AffinityGroup}}",
      "Region": "{{Region}}",
      "DisableGeoReplication": false
    }
  ],
  "CloudServices": [
    {
      "Name": "{{CloudService}}",
      "AffinityGroup": "{{AffinityGroup}}",
      "Region": "{{Region}}",
      "Description": "Brewmaster ElasticSearch Cloud Service",
      "Deployment": {
        "Name": "{{CloudDeploymentName}}",
        "VirtualMachines": [
          {
            "Name": "{{ServerNamePrefix}}",
            "RoleSize": "{{VmSize}}",
            "AvailabilitySet": "es-avset",
            "OsVirtualDisk": {
              "OsType": "Windows",
              "OsImageName": "a699494373c04fc0bc8f2bb1389d6106__Windows-Server-2012-R2-*"
            },
            "WindowsConfigSet": {
              "LocalAdminCredentialId": "vmadmin",
              "EnableAutomaticUpdates": false,
              "ChangePasswordAtLogon": false,
              "DisableRdp": false
            },
            "ConfigSets": [
              "ElasticSearchNode"
            ]
          }
        ],
        "DiskStorageAccount": "{{DiskStore}}",
        "RemoveUnreferencedVms": false
      }
    }
  ],
  "DeploymentGroups": [],
  "Credentials": [
    {
      "Name": "vmadmin",
      "UserName": "{{AdminName}}",
      "Password": "{{AdminPassword}}"
    }
  ],
  "ConfigSets": [
    {
      "Name": "ElasticSearchNode",
      "Description": "Elastic Search Server",
      "Endpoints": [
        {
          "Name": "HTTP",
          "LocalPort": 9200,
          "Protocol": "tcp",
          "Port": 9200,
          "EnableDirectServerReturn": false,
          "Rules": [],
          "LoadBalancerProbe": {
            "Name": "http",
            "Protocol": "Http",
            "Path": "/",
            "IntervalInSeconds": 15,
            "TimeoutInSeconds": 31
          }
        }
      ],
      "ConfigurationIds": [
        "InstallES"
      ]
    }
  ],
  "Configurations": [
    {
      "Name": "InstallES",
      "Resources": [
        {
          "Type": "Package",
          "ImportModule": null,
          "ImportTypeName": null,
          "Name": "InstallWebPI",
          "Args": {
            "Credential": "vmadmin",
            "Name": "Microsoft Web Platform Installer 4.6",
            "ProductId": "16C7D2AD-20CA-491E-80BC-8607A9AACED9",
            "Path": "http://download.tuxfamily.org/notepadplus/6.6.1/npp.6.6.1.Installer.exe",
            "LogPath": "%BrewmasterDir%\\Logs\\WebPlatformInstaller_amd64_en-US.log",
            "Ensure": "Present"
          },
          "Nodes": [],
          "Requires": [],
          "Description": null
        }
      ],
      "Args": {}
    }
  ]
}
